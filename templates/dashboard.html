<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - Marketplace</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="header">
        <h1>ðŸ“Š Dashboard Admin</h1>
        <a href="{{ url_for('logout') }}" class="btn btn-secondary">DÃ©connexion</a>
    </div>
    
    <div class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Commandes actives</h3>
                <div class="stat-number">{{ stats.active_orders }}</div>
            </div>
            <div class="stat-card">
                <h3>Mode simplifiÃ©</h3>
                <div class="stat-number">Actif</div>
                <small style="color: #666;">Workers dÃ©sactivÃ©s</small>
            </div>
        </div>
        
        <section class="section">
            <h2>ðŸ“‹ Commandes</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>RÃ©fÃ©rence</th>
                        <th>Client Anonyme</th>
                        <th>Telegram</th>
                        <th>Type</th>
                        <th>QuantitÃ©</th>
                        <th>Prix</th>
                        <th>Statut</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in orders %}
                    <tr>
                        <td><strong>{{ order.order_id }}</strong></td>
                        <td>{{ order.client_id }}</td>
                        <td>
                            <small>
                                ID: {{ order.telegram_id }}<br>
                                {% if order.telegram_username and order.telegram_username != 'N/A' %}
                                    @{{ order.telegram_username }}
                                {% else %}
                                    <em>Pas de username</em>
                                {% endif %}
                            </small>
                        </td>
                        <td>{{ order.platform }}</td>
                        <td>{{ order.quantity }}</td>
                        <td>{{ order.price }} USDT</td>
                        <td>
                            {% if order.status == 'pending' %}
                                <span class="badge badge-warning">En attente</span>
                            {% elif order.status == 'paid' %}
                                <span class="badge badge-info">PayÃ©</span>
                            {% elif order.status == 'distributed' %}
                                <span class="badge badge-success">DistribuÃ©</span>
                            {% else %}
                                <span class="badge">{{ order.status }}</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ url_for('order_details', order_id=order.order_id) }}" class="btn btn-sm btn-primary">GÃ©rer</a>
                            <form method="POST" action="{{ url_for('delete_order_route', order_id=order.order_id) }}" style="display: inline;">
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Supprimer cette commande ?')">Suppr</button>
                            </form>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="8" class="text-center">Aucune commande</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
        
        <!-- Workers dÃ©sactivÃ©s - mode simplifiÃ© -->
        
        <section class="section">
            <h2>ðŸ’¬ Messages Support <a href="{{ url_for('messages_list') }}" class="btn btn-sm btn-primary">Voir tout</a></h2>
            {% if support_messages %}
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Client</th>
                        <th>Message</th>
                        <th>ExpÃ©diteur</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for msg in support_messages[:10] %}
                    <tr>
                        <td><small>{{ msg.created_at }}</small></td>
                        <td>{{ msg.client_id }}</td>
                        <td>{{ msg.message[:50] }}{% if msg.message|length > 50 %}...{% endif %}</td>
                        <td>
                            {% if msg.sender_type == 'client' %}
                                <span class="badge badge-info">Client</span>
                            {% else %}
                                <span class="badge badge-success">Admin</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ url_for('client_messages', client_id=msg.client_id) }}" class="btn btn-sm btn-primary">RÃ©pondre</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="text-center">Aucun message support pour le moment.</p>
            {% endif %}
        </section>
    </div>
</body>
</html>
